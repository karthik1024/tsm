<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tsm: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tsm
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tsm Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/tinverse/tsm"></a> <a href="http://codecov.io/github/tinverse/tsm?branch=master"></a> </p><h3>What is tsm?</h3>
<p>tsm is a flexible state machine framework with support for Hierarchical and Orthogonal State Machines.</p>
<h3>Features:</h3>
<ul>
<li>Hierarchical State machine (Unit tests and test examples welcome).</li>
<li>Thread safe event queue.</li>
<li>Ease of installation/distribution.</li>
<li>Ability to customize behavior by defining execution policies.</li>
</ul>
<h3>Current Status</h3>
<ul>
<li>Thread-safe event queue.</li>
<li>Hierarchical State Machine.</li>
<li>No manual memory allocation.</li>
<li>2 simultaneous Orthogonal State Machines.</li>
</ul>
<h3>External Dependencies:</h3>
<p>Gflags, Glog, Gtest</p>
<h3>TODOs</h3>
<ul>
<li>support other ExecutionPolicy classes.</li>
</ul>
<h3>Build:</h3>
<p>Install cmake (sudo apt install cmake) or download on windows and add cmake to system path. Read the CMakeLists.txt to get a good feel for it. The cmake/superbuild/ folder contains the cmake files that download and install the external dependencies.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git clone https://github.com/tinverse/tsm.git</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cd tsm</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;mkdir build</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;cd build</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;cmake -DBUILD_DEPENDENCIES=ON ..</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;make -j4 #or however many cores are at your disposal</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;cmake -DBUILD_DEPENDENCIES=OFF ..</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;make -j4</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;./tsm_tests</div></div><!-- fragment --><h3>Documentation</h3>
<p>For a primer on UML state machines, look <a href="https://en.wikipedia.org/wiki/UML_state_machine">here</a>.</p>
<h6>Using tsm: <a href="https://github.com/tinverse/tsm/blob/master/test/GarageDoorDef.h">GarageDoorDef.h</a></h6>
<p>Create the state machine definition (HSMDef). </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;struct GarageDoorDef : public StateMachineDef&lt;GarageDoorDef&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   GarageDoorDef(State* parent = nullptr)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;     : StateMachineDef&lt;GarageDoorDef&gt;(parent)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;     , name(&quot;Garage Door HSM&quot;)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;     , doorOpen(&quot;Door Open&quot;)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;     ...</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   {</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;       // TransitionTable</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;       add(doorClosed, click_event, doorOpening);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;       add(doorOpening, topSensor_event, doorOpen);</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;       ...</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;   }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;   State* getStartState() const { return &amp;doorClosed; }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;   State* getStopState() const { return nullptr; }</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;   // States</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;   State doorOpen;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;   State doorOpening;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   ...</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   // Events</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   Event click_event;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   ...</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;};</div></div><!-- fragment --><p> Make sure that the getStartState and getStopState methods are overridden in the HSMDef.</p>
<p>Wrap the definition around a statemachine and then around an execution policy. Here we have two options.</p>
<p>a. Create a state machine that executes in the context of the parent thread. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SimpleStateMachine&lt;GarageDoorDef&gt; sm;</div></div><!-- fragment --><p>b. Create a state machine that processes incomming events in its own thread. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;AsyncStateMachine&lt;GarageDoorDef&gt; sm;</div></div><!-- fragment --><p>Send events to the state machine by using sendEvent method provided by the policy. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sm.sendEvent(sm.doorOpen);</div></div><!-- fragment --><p>If the state machine is running in parent thread context, invoke the <code>step</code> method to process the first event in the event queue. The AsyncStateMachine will immediately process an event on completion of prior event processing. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sm.step();</div></div><!-- fragment --><h3>Architecture</h3>
<p>Clients need include only the <a class="el" href="tsm_8h.html">tsm.h</a> file. The <code>StateMachine::getStartState</code> method should be overridden to reflect the correct starting state of your HSM.</p>
<p>The design uses CRTP to force Actions and Guards to be callbacks that are part of your HSM class. See the implementation of</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;  template &lt;typename DerivedHSM&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  struct StateMachine { </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  ...</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;};</div></div><!-- fragment --><p>The AsyncStateMachine processes events in it's own thread. The processing of events is single threaded for OrthogonalHSMs (and HSMs). So when it is started using a call to <code>startSM</code>, the <code>StateMachine</code> will block on the call to <code>nextEvent</code> in the <code>execute</code> method. See <a class="el" href="tsm_8h.html">tsm.h</a>. The main advantage is that the only external interface to the StateMachine can be the EventQueue. Any "client" can asynchronously place an event in the event queue as long as they have a pointer to it. As soon as the StateMachine is done with its processing, it will pick up the first event in the queue and process it. This can be seen in the test/*.cpp files.</p>
<p>For testing the AsyncStateMachine, the AsyncExecWithObserver class is used with a special Observer class that blocks the parent thread until the AsyncStateMachine finishes event processing. The state machine thread then calls a notify method that releases the mutexblocking the parent thread.</p>
<p>States and Events generate unique Ids under the hood. This process is currently too simplistic. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
